var JsonFormatEntrance=(function(){var q,n,m,h,f,j=JsonFormatDealer,k=+(new Date()),p,t,a,u;var i=function(A){switch(A[0]){case"NOT JSON":n.style.display="";q.innerHTML='<span class="x-json-tips">JSON不合法，请检查：</span>';a=+(new Date());break;case"FORMATTING":t=+(new Date());clearTimeout(f);var w=document.getElementById("optionBar");if(w){w.parentNode.removeChild(w)}w=document.createElement("div");w.id="optionBar";var z=document.createElement("button"),y=document.createElement("button");z.id="buttonPlain";z.innerText="元数据";y.id="buttonFormatted";y.innerText="格式化";y.classList.add("selected");var x=false;z.addEventListener("click",function(){if(!x){x=true;n.style.display="";q.style.display="none";y.classList.remove("selected");z.classList.add("selected")}},false);y.addEventListener("click",function(){if(x){x=false;n.style.display="none";q.style.display="";y.classList.add("selected");z.classList.remove("selected")}},false);w.appendChild(z);w.appendChild(y);document.addEventListener("click",l,false);q.parentNode.appendChild(w);break;case"FORMATTED":h.style.display="";q.innerHTML=A[1];u=+(new Date());break;default:throw new Error("Message not understood: "+A[0])}};var s=0;function d(A){var y,x,w,z;for(x=A.length-1;x>=0;x--){y=A[x];y.classList.add("collapsed");if(!y.id){y.id="kvov"+(++s);w=y.firstElementChild;while(w&&!w.classList.contains("blockInner")){w=w.nextElementSibling}if(!w){continue}z=w.children.length;var B=z+(z===1?" item":" items");m.insertAdjacentHTML("beforeend","\n#kvov"+s+'.collapsed:after{color: #aaa; content:" // '+B+'"}')}}}function b(x){for(var w=x.length-1;w>=0;w--){x[w].classList.remove("collapsed")}}var g=navigator.platform.indexOf("Mac")!==-1,c;if(g){c=function(w){return w.metaKey}}else{c=function(w){return w.ctrlKey}}function l(z){if(z.which===1){var y=z.target;if(y.className==="e"){z.preventDefault();var x=y.parentNode,D=q,w=document.body.offsetHeight,B=document.body.scrollTop,A;if(x.classList.contains("collapsed")){if(c(z)){b(x.parentNode.children)}else{b([x])}}else{if(c(z)){d(x.parentNode.children)}else{d([x])}}D.style.marginBottom=0;if(document.body.offsetHeight<window.innerHeight){return}if(document.body.scrollTop===B){return}var C=B-document.body.scrollTop+8;D.style.marginBottom=C+"px";document.body.scrollTop=B;return}}}var e=function(w){i(w)};var v=function(){};var r=function(w){q=document.getElementById("jfContent");if(!q){q=document.createElement("div");q.id="jfContent";document.body.appendChild(q)}q.style.display="";n=document.getElementById("jfContent_pre");if(!n){n=document.createElement("pre");n.id="jfContent_pre";document.body.appendChild(n)}n.innerHTML=w;n.style.display="none";m=document.getElementById("jfStyleEl");if(!m){m=document.createElement("style");document.head.appendChild(m)}h=document.getElementById("formattingMsg");if(!h){h=document.createElement("pre");h.id="formattingMsg";h.innerHTML='<svg id="spinner" width="16" height="16" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" version="1.1"><path d="M 150,0 a 150,150 0 0,1 106.066,256.066 l -35.355,-35.355 a -100,-100 0 0,0 -70.711,-170.711 z" fill="#3d7fe6"></path></svg> 格式化中...';document.body.appendChild(h)}j.postMessage({type:"SENDING TEXT",text:w,length:w.length})};var o=function(){try{q.innerHTML="";n.innerHTML=""}catch(w){}};return{format:r,clear:o,postMessage:e,disconnect:v}})();