baidu.namespace.register("baidu.fdphelper");baidu.fdphelper=(function(){var _G_CUR_DOC_="fdp";var _DOC_PATH={fdp:"http://fe.baidu.com/space/doc/",fe:"http://fe.baidu.com/doc/"};var _dataCache={fdp:[],fe:[]};var _getFdpDocData=function(){if(!_dataCache.fdp.length){var url="http://fe.baidu.com/space/static/js/doc_data.js?v="+(new Date()-1);chrome.extension.sendMessage({type:MSG_TYPE.GET_JS,link:url},function(respData){eval(respData.content);_parseFdpDocData(g_docData);jQuery("#num-fdp-doc").html(_dataCache.fdp.length)})}};var _getFeDocData=function(){if(!_dataCache.fe.length){var url="http://fe.baidu.com/doc/_ADoc/search/Data/docData.js?v="+(new Date()-1);chrome.extension.sendMessage({type:MSG_TYPE.GET_JS,link:url},function(respData){eval(respData.content);_dataCache.fe=docData;jQuery("#num-fe-doc").html(docData.length)})}};var _parseFdpDocData=function(fdpData){_dataCache.fdp=[];var t;for(var url in fdpData){t=fdpData[url];_dataCache.fdp.push({url:url,title:t[0],author:t[1],mtime:t[2]})}};var _searchAdoc=function(data,key){var titleResult=[];var authorResult=[];var urlResult=[];try{var reg=new RegExp(key,"i");for(var i=0,l=data.length;i<l;i++){var item=data[i];if(reg.test(item.title)){titleResult.push(item)}else{if(reg.test(item.author)){authorResult.push(item)}else{if(reg.test(item.url)){urlResult.push(item)}}}}return titleResult.concat(authorResult.concat(urlResult))}catch(e){return[]}};var _searchLighter=function(word,key){var reg=new RegExp(key,"ig");return word.replace(reg,function($0){return'<b class="-d-highlight">'+$0+"</b>"})};var _doDocSearch=function(){var key=jQuery("#fdp-search-input").val().trim();var $resultEl=jQuery("#fdp-doc-rst-list");if(key.length===0){$resultEl.html('<div class="-d-no-result">请输入关键字进行检索</div>');return}var data=_searchAdoc(_dataCache[_G_CUR_DOC_],key);if(data.length===0){$resultEl.html('<div class="-d-no-result">很抱歉，没有结果</div>');return}var tpl='<dd><i>[{4}] </i><a href="{1}" target="_blank" title="{2}">{0}</a><span class="-d-author">{3}</span></dd>';var html=['<dt>检索结果：共找到 <b class="-d-highlight">'+data.length+"</b> 个文档</dt>"];for(var i=0,l=data.length;i<l;i++){if(i>300){break}var item=data[i];var url=item.url;var title=item.title;var lastDotIndex=url.lastIndexOf(".");var fileType="";if(lastDotIndex>=0){fileType=url.substr(lastDotIndex+1)}html.push(tpl.format(_searchLighter(item.title,key),_DOC_PATH[_G_CUR_DOC_]+url,title,_searchLighter(item.author,key),fileType.toLowerCase()))}$resultEl.html(html.join(""))};var _bindDocSourceEvent=function(){jQuery("#fdp-doc-nav .-d-normal").click(function(e){var $this=jQuery(this);$this.addClass("-d-selected").siblings("li").removeClass("-d-selected");if($this.is("#fdp-doc")){_getFdpDocData();_G_CUR_DOC_="fdp"}else{if($this.is("#fe-doc")){_getFeDocData();_G_CUR_DOC_="fe"}}_doDocSearch()})};var _bindSearchInputEvent=function(){jQuery("#fdp-search-input").keyup(function(e){_doDocSearch()})};var _bindSearchBtnEvent=function(){jQuery("#fdp-search-btn").click(function(e){_doDocSearch()})};var _init=function(){_getFdpDocData();_getFeDocData();_bindDocSourceEvent();_bindSearchBtnEvent();_bindSearchInputEvent()};return{init:_init}})();jQuery(function(){baidu.fdphelper.init()});