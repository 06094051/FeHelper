var BgPageInstance=(function(){var q={css:false,js:false,html:true,allDone:false};var a=null;var f=function(){a=window.setInterval(function(){if(q.css&&q.js&&q.html){q.allDone=true;window.clearInterval(a)}},100)};var e=function(t){if(q.allDone){chrome.tabs.sendMessage(t.id,{type:MSG_TYPE.BROWSER_CLICKED,event:MSG_TYPE.FCP_HELPER_DETECT})}else{baidu.feNotification.notifyText({message:"\u6B63\u5728\u51C6\u5907\u6570\u636E\uFF0C\u8BF7\u7A0D\u7B49..."})}};var l=function(t){chrome.tabs.sendMessage(t.id,{type:MSG_TYPE.BROWSER_CLICKED,event:MSG_TYPE.GRID_DETECT})};var g=function(t){chrome.tabs.getAllInWindow(null,function(x){var y=false;var v;for(var w=0,u=x.length;w<u;w++){if(/^chrome.*fdp.html$/.test(x[w].url)){y=true;v=x[w].id;break}}if(!y){chrome.tabs.create({url:"template/fehelper_fdp.html",selected:true})}else{chrome.tabs.update(v,{selected:true});baidu.feNotification.notifyText({message:"FE\u6587\u6863\u68C0\u7D22\u5DE5\u5177\u5DF2\u542F\u52A8"})}})};var p=function(t){chrome.tabs.getAllInWindow(null,function(x){var y=false;var v;for(var w=0,u=x.length;w<u;w++){if(/^chrome.*endecode.html$/.test(x[w].url)){y=true;v=x[w].id;break}}if(!y){chrome.tabs.create({url:"template/fehelper_endecode.html",selected:true})}else{chrome.tabs.update(v,{selected:true});baidu.feNotification.notifyText({message:"\u5B57\u7B26\u4E32\u7F16\u89E3\u7801\u5DE5\u5177\u5DF2\u542F\u52A8"})}})};var s=function(t){chrome.tabs.getAllInWindow(null,function(x){var y=false;var v;for(var w=0,u=x.length;w<u;w++){if(/^chrome.*jsonformat.html$/.test(x[w].url)){y=true;v=x[w].id;break}}if(!y){chrome.tabs.create({url:"template/fehelper_jsonformat.html",selected:true})}else{chrome.tabs.update(v,{selected:true})}})};var m=function(t){chrome.tabs.getAllInWindow(null,function(x){var y=false;var v;for(var w=0,u=x.length;w<u;w++){if(/^chrome.*qrcode.html$/.test(x[w].url)){y=true;v=x[w].id;break}}if(!y){chrome.tabs.create({url:"template/fehelper_qrcode.html",selected:true})}else{chrome.tabs.update(v,{selected:true})}})};var d=[];var r=function(t){chrome.tabs.getSelected(null,function(u){d[u.id].cancel();if(!t){baidu.feNotification.notifyText({message:"\u5BF9\u4E0D\u8D77\uFF0C\u68C0\u6D4B\u5931\u8D25"})}else{baidu.feNotification.notifyHtml("template/fehelper_wpo.html?"+JSON.stringify(t))}})};var k=function(){chrome.tabs.getSelected(null,function(t){d[t.id]=baidu.feNotification.notifyText({message:"\u6B63\u5728\u7EDF\u8BA1\uFF0C\u8BF7\u7A0D\u540E...",autoClose:false});chrome.tabs.sendMessage(t.id,{type:MSG_TYPE.GET_PAGE_WPO_INFO})})};var j=function(t){chrome.tabs.getSelected(null,function(u){switch(t){case MSG_TYPE.FCP_HELPER_DETECT:e(u);break;case MSG_TYPE.GRID_DETECT:l(u);break;case MSG_TYPE.FDP_HELPER:g(u);break;case MSG_TYPE.EN_DECODE:p(u);break;case MSG_TYPE.JSON_FORMAT:s(u);break;case MSG_TYPE.QR_CODE:m(u);break;case MSG_TYPE.SHOW_PAGE_LOAD_TIME:k();break}})};var b=function(){i();baidu.contextMenuId=chrome.contextMenus.create({title:"FeHelper-FE\u52A9\u624B"});chrome.contextMenus.create({title:"\u7F16\u7801\u68C0\u6D4B",parentId:baidu.contextMenuId,onclick:function(u,t){e(t)}});chrome.contextMenus.create({title:"\u6805\u683C\u68C0\u6D4B",parentId:baidu.contextMenuId,onclick:function(u,t){l(t)}});if(baidu.feOption.getOptionItem("opt_item_showfdpmenu")==="true"){chrome.contextMenus.create({title:"FE\u6587\u6863\u68C0\u7D22",parentId:baidu.contextMenuId,onclick:function(u,t){g(t)}})}chrome.contextMenus.create({title:"\u5B57\u7B26\u4E32\u7F16\u89E3\u7801",parentId:baidu.contextMenuId,onclick:function(u,t){p(t)}});chrome.contextMenus.create({title:"\u7F51\u9875\u52A0\u8F7D\u8017\u65F6",parentId:baidu.contextMenuId,onclick:function(u,t){k()}})};var i=function(){if(!baidu.contextMenuId){return}chrome.contextMenus.remove(baidu.contextMenuId);baidu.contextMenuId=null};var c=function(){if(baidu.feOption.getOptionItem("opt_item_contextMenus")==="true"){b()}else{i()}};var o=function(){chrome.extension.onMessage.addListener(function(u,t,v){if(u.type==MSG_TYPE.GET_CSS){baidu.network.readFileContent(u.link,v)}else{if(u.type==MSG_TYPE.GET_JS){baidu.network.readFileContent(u.link,v)}else{if(u.type==MSG_TYPE.GET_HTML){baidu.network.readFileContent(u.link,v)}else{if(u.type==MSG_TYPE.GET_COOKIE){baidu.network.getCookies(u,v)}else{if(u.type==MSG_TYPE.REMOVE_COOKIE){baidu.network.removeCookie(u,v)}else{if(u.type==MSG_TYPE.SET_COOKIE){baidu.network.setCookie(u,v)}else{if(u.type==MSG_TYPE.CSS_READY){q.css=true}else{if(u.type==MSG_TYPE.JS_READY){q.js=true}else{if(u.type==MSG_TYPE.HTML_READY){q.html=true}else{if(u.type==MSG_TYPE.GET_OPTIONS){baidu.feOption.doGetOptions(u.items,v)}else{if(u.type==MSG_TYPE.SET_OPTIONS){baidu.feOption.doSetOptions(u.items,v);c()}else{if(u.type==MSG_TYPE.CALC_PAGE_LOAD_TIME){r(u.wpo)}}}}}}}}}}}}return true})};var n=function(){var x=new Date();var v=x.getFullYear();var y=x.getMonth();var u=x.getDate();var t=false;var w=window.localStorage.getItem("fehelper_user_count");if(!w){t=true}else{w=JSON.parse(w);if(w.year>v||(w.year===v&&w.month>y)||(w.year===v&&w.month===y&&w.day>u)){t=true}}if(t){window.localStorage.setItem("fehelper_user_count",JSON.stringify({year:v,month:y,day:u}));baidu.log.track(LOG.fehelper_user_count)}};var h=function(){n();o();f();c()};return{init:h,runHelperByType:j}})();BgPageInstance.init();